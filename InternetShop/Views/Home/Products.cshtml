@model IEnumerable<Product>

@{
    ViewData["Title"] = "Products";
    var i = 0;
}

<link rel="stylesheet" href="~/css/sidebar.css"/>

<div class="page-wrapper chiller-theme toggled">
    <a id="show-sidebar" class="btn btn-sm btn-dark" href="#">
        <i class="fas fa-bars"></i>
    </a>
    <nav id="sidebar" class="sidebar-wrapper">
        <div class="sidebar-content">
            <div class="sidebar-brand">
                <a href="#">Categories</a>
                <div id="close-sidebar">
                    <i class="fas fa-times"></i>
                </div>
            </div>
            <div class="sidebar-menu">
                <ul>
                    <li>
                        <a href="#">
                            <i class="fa fa-calendar"></i>
                            <span>Drinks</span>
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <i class="fa fa-folder"></i>
                            <span>Meat</span>
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <i class="fa fa-book"></i>
                            <span>Fruits</span>
                        </a>
                    </li>
                </ul>
            </div>
            <!-- sidebar-menu  -->
        </div>
    </nav>
    <!-- sidebar-wrapper  -->

    <main class="page-content">
        <div class="container-fluid">
            <form asp-controller="Home" asp-action="Products" class="form-inline">
                <input class="form-control mr-sm-2" type="text" name="SearchTerm" placeholder="Search" aria-label="Search">
                <input type="submit" value="Filter" />
            </form>
            <!--<div class="row">-->
            @foreach (var product in Model)
            {
                if (i == 2)
                {
                    i = 0;
                    //@:</div><div class="row">
                }
                <div class="col-sm-4">
                    <div class="card" product-id="@product.ProductID">
                        <img class="card-img-top" src="@product.Image" alt="@product.ProductName" style='display:block; width:150px;height:150px;'>
                        <div class="card-body">
                            <h5 class="card-title">@product.ProductName</h5>
                            <p class="card-text">@product.Description</p>
                            <a href="#" class="btn btn-primary view-product-btn">Go somewhere</a>
                        </div>
                    </div>
                </div>
                if (i == 2)
                {
                    i = 0;
                }
                else
                {
                    ++i;
                }
            }
            <!--</div>-->

            <!-- Modal -->
            <div class="modal fade" id="productModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-body">
                            <div class="container-fluid">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                                <div class="row">
                                    <div class="col-md-6">
                                        <img src="~/images/product.png" id="product-image">
                                    </div>
                                    <div class="col-md-6">
                                        <div class="product-detail-row">
                                            <div class="col-md-6 row-title">Name:</div>
                                            <div id="product-name" class="product-info">?</div>
                                        </div>
                                        <div class="product-detail-row">
                                            <div class="col-md-6 row-title">Price:</div>
                                            <div id="product-price" class="product-info">?</div>
                                        </div>
                                        <div class="product-detail-row">
                                            <div class="col-md-6 row-title">Category:</div>
                                            <div id="product-category" class="product-info">?</div>
                                        </div>
                                        <div class="product-detail-row">
                                            <div class="col-md-6 row-title">Description:</div>
                                            <div id="product-description" class="product-info">?</div>
                                        </div>
                                        <div class="product-detail-row">
                                            <div class="col-md-6 row-title">In Stock:</div>
                                            <div id="product-in-stock" class="product-info">?</div>
                                        </div>
                                        <button type="button" class="btn btn-default btn-sm">
                                            <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Edit
                                        </button>
                                        <button type="button" class="btn btn-default btn-sm">
                                            <span class="glyphicon glyphicon-trash" aria-hidden="true"></span> Delete
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>
    <!-- page-content" -->
</div>
<!-- page-wrapper -->

<script>jQuery(function($) {

        $(".sidebar-dropdown > a").click(function() {
            $(".sidebar-submenu").slideUp(200);
            if (
                $(this)
                    .parent()
                    .hasClass("active")
            ) {
                $(".sidebar-dropdown").removeClass("active");
                $(this)
                    .parent()
                    .removeClass("active");
            } else {
                $(".sidebar-dropdown").removeClass("active");
                $(this)
                    .next(".sidebar-submenu")
                    .slideDown(200);
                $(this)
                    .parent()
                    .addClass("active");
            }
        });

        $("#close-sidebar").click(function() {
            $(".page-wrapper").removeClass("toggled");
        });
        $("#show-sidebar").click(function() {
            $(".page-wrapper").addClass("toggled");
        });


    $(".view-product-btn").click(function () {
        var productId = $(this).parents('.card').attr('product-id');
        $.ajax('/Home/GetProduct?id=' + productId).done(function (product) {

            console.log(product)
            $('#productModal #product-name').html(product.productName);
            $('#productModal #product-price').html(product.price);
            $('#productModal #product-category').html(product.category.name);
            $('#productModal #product-description').html(product.description);
            $('#productModal #product-image').attr('src', product.image);

            $('#productModal').modal();
        }).fail(function () {
            alert('failed to fetch product');
        })

        
    })

});</script>